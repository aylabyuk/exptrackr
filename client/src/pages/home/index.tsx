import { GetServerSideProps, NextPage } from 'next'
import Head from 'next/head'
import React from 'react'
import {
  getCurrentLoggedInUser,
  userApi,
} from '../../redux/features/user/user-api'
import { selectCurrentUser } from '../../redux/features/user/user-reducer'
import { useAppSelector } from '../../redux/hooks'
import { wrapper } from '../../redux/store'

export interface HomeProps {
  resolvedUrl: string
  children: React.ReactNode
}

export const Home: NextPage<HomeProps> = ({ resolvedUrl }) => {
  const currentUser = useAppSelector(selectCurrentUser)

  console.log(currentUser)

  return (
    <div className="">
      <Head>
        <title>Expense Tracker - Home</title>
        <meta name="description" content="Generated by create next app" />
      </Head>
    </div>
  )
}

export const getServerSideProps: GetServerSideProps =
  wrapper.getServerSideProps((store) => async (ctx) => {
    store.dispatch(getCurrentLoggedInUser.initiate({}))
    await Promise.all(userApi.util.getRunningOperationPromises())

    return {
      props: {
        resolvedUrl: ctx.resolvedUrl,
      },
    }
  })

export default Home
